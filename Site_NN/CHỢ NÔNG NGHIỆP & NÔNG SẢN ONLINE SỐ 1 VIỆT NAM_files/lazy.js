(function (e, t, n, r) { e.fn.lazy = function (r) { function i(n) { if (typeof n != "boolean") n = false; p.each(function () { var r = e(this); var i = this.tagName.toLowerCase(); if (o(r) || n) { if (r.attr(h.attribute) && (i == "img" && r.attr(h.attribute) != r.attr("src") || i != "img" && r.attr(h.attribute) != r.css("background-image")) && !r.data("loaded") && (r.is(":visible") || !h.visibleOnly)) { var s = e(new Image); ++d; if (h.onError) s.error(function () { c(h.onError, r); l() }); else s.error(function () { l() }); var u = true; s.one("load", function () { var e = function () { if (u) { t.setTimeout(e, 100); return } r.hide(); if (i == "img") r.attr("src", s.attr("src")); else r.css("background-image", "url(" + s.attr("src") + ")"); r[h.effect](h.effectTime); if (h.removeAttribute) r.removeAttr(h.attribute); c(h.afterLoad, r); s.unbind("load"); s.remove(); l() }; e() }); c(h.beforeLoad, r); s.attr("src", r.attr(h.attribute)); c(h.onLoad, r); u = false; if (s.complete) s.load(); r.data("loaded", true) } } }); p = e(p).filter(function () { return !e(this).data("loaded") }) } function s() { if (h.delay >= 0) setTimeout(function () { i(true) }, h.delay); if (h.delay < 0 || h.combined) { i(false); e(h.appendScroll).bind("scroll", f(h.throttle, i)); e(h.appendScroll).bind("resize", f(h.throttle, i)) } } function o(e) { var t = u(), n = a(), r = e.offset().top, i = e.height(); return t + n + h.threshold > r && r + i > t - h.threshold } function u() { if (n.documentElement.scrollTop) return n.documentElement.scrollTop; return n.body.scrollTop } function a() { if (t.innerHeight) return t.innerHeight; if (n.documentElement && n.documentElement.clientHeight) return n.documentElement.clientHeight; if (n.body && n.body.clientHeight) return n.body.clientHeight; if (n.body && n.body.offsetHeight) return n.body.offsetHeight; return h.fallbackHeight } function f(e, t) { function n() { function n() { i = +(new Date); t.apply() } var s = +(new Date) - i; r && clearTimeout(r); if (s > e || !h.enableThrottle) n(); else r = setTimeout(n, e - s) } var r; var i = 0; return n } function l() { --d; if (!p.size() && !d) c(h.onFinishedAll, null) } function c(e, t) { if (e) { if (t !== null) e(t); else e() } } var h = { bind: "load", threshold: 500, fallbackHeight: 2e3, visibleOnly: true, appendScroll: t, delay: -1, combined: false, attribute: "title", removeAttribute: true, effect: "show", effectTime: 0, enableThrottle: false, throttle: 250, beforeLoad: null, onLoad: null, afterLoad: null, onError: null, onFinishedAll: null }; if (r) e.extend(h, r); var p = this; var d = 0; if (h.bind == "load") e(t).load(s); else if (h.bind == "event") s(); if (h.onError) p.bind("error", function () { c(h.onError, e(this)) }); return this }; e.fn.Lazy = e.fn.lazy })(jQuery, window, document)